<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог - Магазин велосипедов</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header__content">
            <a href="/" class="logo">VeloPro</a>
            <nav>
                <ul class="header_list">
                    <li><a href="index.html" class="header_link">Главная</a></li>
                    <li><a href="catalog.html" class="header_link active">Каталог</a></li>
                    <li><a href="about.html" class="header_link">О нас</a></li>
                    <li>
                        <a href="cart.html" class="cart_icon header_link">
                            Корзина
                            <span class="cart_count">0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <div class="catalog-header">
            <h1>Каталог велосипедов</h1>
        
        <div class="categories-filter">
            <a href="catalog.html" class="category-link">Все</a>
            <a href="catalog.html?category=mountain" class="category-link">Горные</a>
            <a href="catalog.html?category=road" class="category-link">Шоссейные</a>
            <a href="catalog.html?category=city" class="category-link">Городские</a>
            <a href="catalog.html?category=children" class="category-link">Детские</a>
        </div>
        
        <!-- Контейнер для товаров (будет заполняться динамически) -->
        <div class="product-grid">
            <!-- Здесь будут отображаться товары из API -->
            <p class="loading-message">Загрузка товаров...</p>
        </div>
    </main>
    <footer>
        <div class="footer_content">
            <div class="footer_section">
                <h3>Навигация</h3>
                <ul>
                    <li><a href="catalog.html">Каталог</a></li>
                    <li><a href="cart.html">Корзина</a></li>
                    <li><a href="about.html">О нас</a></li>
                
                </ul>
            </div>
            <div class="footer_section">
                <h3>Категории</h3>
                <ul>
                    <li><a href="catalog.html?category=mountain">Горные велосипеды</a></li>
                    <li><a href="catalog.html?category=road">Шоссейные велосипеды</a></li>
                    <li><a href="catalog.html?category=city">Городские велосипеды</a></li>
                    <li><a href="catalog.html?category=children">Детские велосипеды</a></li>
                </ul>
            </div>
            <div class="footer_section">
                <h3>Контакты</h3>
                <ul>
                    <li>Телефон: +7 (917) 260-06-21</li>
                    <li>Email: mishkaosip.ru</li>
                    <li>Адрес: г. Самара, Московское шоссе 34Б</li>
                </ul>
            </div>
            <div class="footer_section">
                <h3>Мы в соцсетях</h3>
                <div class="social-links">
                    <a href="https://vk.com/m0tilda228"><img src="img/vk.svg" alt="VK"></a>
                    <a href="https://t.me/MOTILDA228"><img src="img/telegram.svg" alt="Telegram"></a>
                    <a href="https://www.youtube.com/watch?v=GAeB5jpYokk"><img src="img/youtube.svg" alt="YouTube"></a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Получаем категорию из URL
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category') || 'all';
            
            // Подсвечиваем активную категорию
            document.querySelectorAll('.category-filter a').forEach(link => {
                if ((category === 'all' && link.dataset.category === 'all') || 
                    link.dataset.category === category) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Загружаем товары через API
            loadProducts(category);
            
            // Обновляем счетчик товаров в корзине
            updateCartCount();
        });
        
        // Загрузка товаров
        function loadProducts(category) {
            fetch(`/api/products?category=${category}`)
                .then(response => response.json())
                .then(products => {
                    const productsContainer = document.getElementById('products-container');
                    
                    if (products.length === 0) {
                        productsContainer.innerHTML = '<p class="no-products">В данной категории нет товаров</p>';
                        return;
                    }
                    
                    let productsHTML = '';
                    products.forEach(product => {
                        productsHTML += `
                            <div class="product-card">
                                <a href="product.html?id=${product.id}">
                                    <div class="product-image">
                                        <img src="${product.image}" alt="${product.name}" onerror="this.src='img/placeholder.jpg'">
                                    </div>
                                    <h3>${product.name}</h3>
                                    <p class="product-price">${product.price} ₽</p>
                                </a>
                                <button class="add-to-cart-btn" data-id="${product.id}" data-name="${product.name}" 
                                        data-price="${product.price}" data-image="${product.image}">В корзину</button>
                            </div>
                        `;
                    });
                    
                    productsContainer.innerHTML = productsHTML;
                    
                    // Добавляем обработчики событий для кнопок "В корзину"
                    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const product = {
                                id: this.dataset.id,
                                name: this.dataset.name,
                                price: parseInt(this.dataset.price),
                                image: this.dataset.image,
                                quantity: 1
                            };
                            addToCart(product);
                        });
                    });
                })
                .catch(error => {
                    console.error('Ошибка при загрузке товаров:', error);
                    document.getElementById('products-container').innerHTML = 
                        '<p class="error">Произошла ошибка при загрузке товаров. Пожалуйста, попробуйте позже.</p>';
                });
        }
        
        // Добавление товара в корзину
        function addToCart(product) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingProduct = cart.find(item => item.id === product.id);
            
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                cart.push(product);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            
            // Показываем уведомление о добавлении товара
            showNotification(`Товар "${product.name}" добавлен в корзину!`);
        }
        
        // Обновление счетчика товаров в корзине
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            document.querySelector('.cart_count').textContent = cart.length;
        }
        
        // Показать уведомление
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Показываем уведомление
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Скрываем и удаляем уведомление через 3 секунды
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html> 